

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>3. Data Fitting and Interpolation &#8212; PHYS3820 Computational Physics</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mycss.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script src="../_static/tabs.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-NZTDTEW863"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-NZTDTEW863');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Chapter_3/Data_Fitting';</script>
    <link rel="canonical" href="https://saturnaxis.github.io/CompPhysics/Chapter_3/Data_Fitting.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="4. Integration" href="../Chapter_4/Integration.html" />
    <link rel="prev" title="2. Python Basics" href="../Chapter_2/Python_Basics.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../home.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/Comp_Physics_diagram.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/Comp_Physics_diagram.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../home.html">
                    PHYS3820 Computational Physics
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Lectures</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Chapter_1/Gentle_Introduction.html">1. Useful Introduction to Python, GitHub, and LaTex</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Chapter_2/Python_Basics.html">2. Python Basics</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">3. Data Fitting and Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Chapter_4/Integration.html">4. Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Chapter_5/Differentiation.html">5. Differentiation and Searching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Chapter_6/ODEs.html">6. Ordinary Differential Equations (ODEs)</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/saturnaxis/CompPhysics/main?urlpath=tree/Chapter_3/Data_Fitting.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/saturnaxis/CompPhysics/blob/main/Chapter_3/Data_Fitting.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>



<a href="https://github.com/saturnaxis/CompPhysics" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Chapter_3/Data_Fitting.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Data Fitting and Interpolation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-an-experimental-spectrum-problem">3.1. Fitting an experimental spectrum (Problem)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-interpolation">3.2. Linear Interpolation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lagrange-interpolation">3.3. Lagrange Interpolation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cubic-splines">3.4. Cubic Splines</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-fitting">3.5. Data Fitting</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#least-squares-fitting-linear-regression">3.5.1. Least-squares Fitting: linear regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#least-squares-fitting-implementation">3.5.2. Least-Squares Fitting: Implementation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#maximum-likelihood-estimation">3.5.3. Maximum Likelihood Estimation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#problems">3.6. Problems</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="data-fitting-and-interpolation">
<h1><span class="section-number">3. </span>Data Fitting and Interpolation<a class="headerlink" href="#data-fitting-and-interpolation" title="Permalink to this heading">#</a></h1>
<p>The scientific method is based on empiricism, which requires the collection of evidence (data) through an experiment to test a hypothesis.  After the data is collected a scientist needs to synthesize the result by comparing (fitting) the data to predictions made by existing theories or models.  Thus, data fitting is an art worthy by all scientists.  In this chapter, we will discuss two methods of interpolation (e.g., Lagrange and Cubic Splines), least squares fitting, and maximum likelihood estimation.</p>
<section id="fitting-an-experimental-spectrum-problem">
<h2><span class="section-number">3.1. </span>Fitting an experimental spectrum (Problem)<a class="headerlink" href="#fitting-an-experimental-spectrum-problem" title="Permalink to this heading">#</a></h2>
<p>The cross sections (in millibarns; mb) for the resonant scattering of a neutron from a nucleus (see Table <a class="reference internal" href="#cross-section-table"><span class="std std-numref">3.1</span></a>) can be measured in terms of the energy with an associated experimental error.  Your problem is to determine the values for the cross sections at energy values lying between the measured values.</p>
<table class="table" id="cross-section-table">
<caption><span class="caption-number">Table 3.1 </span><span class="caption-text">Experimental values for a scattering cross section, each with an absolute error <span class="math notranslate nohighlight">\(\pm \sigma_i\)</span>, as a function of energy.</span><a class="headerlink" href="#cross-section-table" title="Permalink to this table">#</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>i</p></th>
<th class="head"><p>1</p></th>
<th class="head"><p>2</p></th>
<th class="head"><p>3</p></th>
<th class="head"><p>4</p></th>
<th class="head"><p>5</p></th>
<th class="head"><p>6</p></th>
<th class="head"><p>7</p></th>
<th class="head"><p>8</p></th>
<th class="head"><p>9</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(E_i\)</span> (MeV)</p></td>
<td><p>0</p></td>
<td><p>25</p></td>
<td><p>50</p></td>
<td><p>75</p></td>
<td><p>100</p></td>
<td><p>125</p></td>
<td><p>150</p></td>
<td><p>175</p></td>
<td><p>200</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\(g(E_i)\)</span> (mb)</p></td>
<td><p>10.6</p></td>
<td><p>16.0</p></td>
<td><p>45.0</p></td>
<td><p>83.5</p></td>
<td><p>52.8</p></td>
<td><p>19.9</p></td>
<td><p>10.8</p></td>
<td><p>8.25</p></td>
<td><p>4.7</p></td>
</tr>
<tr class="row-even"><td><p>Error (mb)</p></td>
<td><p>9.34</p></td>
<td><p>17.9</p></td>
<td><p>41.5</p></td>
<td><p>85.5</p></td>
<td><p>51.5</p></td>
<td><p>21.5</p></td>
<td><p>10.8</p></td>
<td><p>6.29</p></td>
<td><p>4.14</p></td>
</tr>
</tbody>
</table>
<p>You can solve this problem in a number of ways, where the simplest is to numerically <em>interpolate</em> between the values of <span class="math notranslate nohighlight">\(g(E_i)\)</span>.  This is direct and easy, but does not account for the experimental noise in the data.  A more appropriate way to solve this problem is to find the <em>best fit</em> of a theoretical function to the data.  The best fit depends on a series of model parameters that are tweaked so that the distance between the experimental points and the model curve is minimized relative to the measurement uncertainty.  In the meantime, let’s see how this data looks graphically.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#plot_Table2_1.py</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span>

<span class="c1">#set default fontsize</span>
<span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">22</span><span class="p">})</span>

<span class="n">aspect</span> <span class="o">=</span> <span class="mf">4.</span><span class="o">/</span><span class="mf">3.</span>
<span class="n">fs</span> <span class="o">=</span> <span class="s1">&#39;x-large&#39;</span>

<span class="n">xvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">225</span><span class="p">,</span><span class="mi">25</span><span class="p">)</span>
<span class="n">yvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">10.6</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mf">83.5</span><span class="p">,</span><span class="mf">52.8</span><span class="p">,</span><span class="mf">19.9</span><span class="p">,</span><span class="mf">10.8</span><span class="p">,</span><span class="mf">8.25</span><span class="p">,</span><span class="mf">4.7</span><span class="p">])</span>
<span class="n">yerror</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">9.34</span><span class="p">,</span><span class="mf">17.9</span><span class="p">,</span><span class="mf">41.5</span><span class="p">,</span><span class="mf">85.5</span><span class="p">,</span><span class="mf">51.5</span><span class="p">,</span><span class="mf">21.5</span><span class="p">,</span><span class="mf">10.8</span><span class="p">,</span><span class="mf">6.29</span><span class="p">,</span><span class="mf">4.14</span><span class="p">])</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">aspect</span><span class="o">*</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="c1">#using the errorbar function from matplotlib</span>
<span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span><span class="n">yvals</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">yerror</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">205</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xvals</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$E_i$ (MeV)&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$g(E_i)$ (mb)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">,</span><span class="n">length</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;neutron_scattering.png&quot;</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/727f14850935231c15264842d9ad9b6baf3221d1723f4f2853938fe3cc58fa20.png" src="../_images/727f14850935231c15264842d9ad9b6baf3221d1723f4f2853938fe3cc58fa20.png" />
</div>
</div>
<p>In the above figure, one can see that the cross section peaks at 75 MeV, although there is a large measurement uncertainty.</p>
<p>Interpolation and curve-fitting are powerful tools that let you treat tables of numbers as if they were analytic functions and <em>sometimes</em> allow you to deduce statistically meaningful constants or conclusions from measurements.  Data fitting can be either <em>global</em> or <em>local</em>, which describes whether or not a single function is used to represent the entire data set.  An incorrect global fit can introduce spurious features between the data points that are nonphysical.  Keep it local and view global interpolation with a critical eye.</p>
</section>
<section id="linear-interpolation">
<h2><span class="section-number">3.2. </span>Linear Interpolation<a class="headerlink" href="#linear-interpolation" title="Permalink to this heading">#</a></h2>
<p>The easiest method to <a class="reference external" href="https://en.wikipedia.org/wiki/Interpolation">interpolate</a> data is linearly.  In this section, we will derive the necessary equations and apply them at the end of Section 2.3 to see how a linear interpolation fares.  First, we must recall the equation of a line: <span class="math notranslate nohighlight">\(g(x) = a_o + a_1x\)</span>, which will be applied to two nearby points (<span class="math notranslate nohighlight">\(x_i\)</span> and <span class="math notranslate nohighlight">\(x_{i+1}\)</span>).  As a result, we find the system of linear equations:</p>
<div class="amsmath math notranslate nohighlight" id="equation-2d3e5d8d-c342-4704-a7b1-5c3fa28b1340">
<span class="eqno">(3.1)<a class="headerlink" href="#equation-2d3e5d8d-c342-4704-a7b1-5c3fa28b1340" title="Permalink to this equation">#</a></span>\[\begin{align}
g(x) &amp;= a_o + a_1x, \\
g(x_i) &amp;= a_o + a_1x_i, \\
 g(x_{i+1}) &amp;= a_o + a_1x_{i+1}.
\end{align}\]</div>
<p>We can combine all three equations <span class="math notranslate nohighlight">\(\left[ g(x),\ g(x_i),\ g(x_{i+1}) \right]\)</span> and solve them analytically (3 equations and 3 unknowns to eliminate the coefficients).  Here, we know <span class="math notranslate nohighlight">\(g(x_i)\)</span> and <span class="math notranslate nohighlight">\(g(x_{i+1})\)</span> from our table.  Thus, we find:</p>
<div class="amsmath math notranslate nohighlight" id="equation-d8c62589-7714-4fff-a90f-a7d8642fc123">
<span class="eqno">(3.2)<a class="headerlink" href="#equation-d8c62589-7714-4fff-a90f-a7d8642fc123" title="Permalink to this equation">#</a></span>\[\begin{align}
g(x) = g(x_i) + \left(\frac{x-x_i}{x_{i+1}-x_i}\right) \left[g(x_{i+1})-g(x_i)\right]
\end{align}\]</div>
<p>Now it’s time to code this up as a function for later.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">linear_interp</span><span class="p">(</span><span class="n">x_n</span><span class="p">,</span><span class="n">g_n</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
    <span class="c1">#generate value for linear interpolation function</span>
    <span class="c1">#x_n = array containing independent values from table</span>
    <span class="c1">#g_n = array containing dependent values from table</span>
    <span class="c1">#x = value to evaluate</span>
    <span class="n">inner_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;=</span><span class="n">x_n</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#search to find first point where x &gt; x_n (in table)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inner_idx</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">inner_idx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">inner_idx</span> <span class="o">=</span> <span class="n">inner_idx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">outer_idx</span> <span class="o">=</span> <span class="n">inner_idx</span><span class="o">+</span><span class="mi">1</span>
    <span class="c1">#print(inner_idx,outer_idx)</span>
    <span class="k">if</span> <span class="n">inner_idx</span> <span class="o">!=</span> <span class="n">outer_idx</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">g_n</span><span class="p">[</span><span class="n">inner_idx</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x_n</span><span class="p">[</span><span class="n">inner_idx</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">x_n</span><span class="p">[</span><span class="n">outer_idx</span><span class="p">]</span><span class="o">-</span><span class="n">x_n</span><span class="p">[</span><span class="n">inner_idx</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">g_n</span><span class="p">[</span><span class="n">outer_idx</span><span class="p">]</span><span class="o">-</span><span class="n">g_n</span><span class="p">[</span><span class="n">inner_idx</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="lagrange-interpolation">
<h2><span class="section-number">3.3. </span>Lagrange Interpolation<a class="headerlink" href="#lagrange-interpolation" title="Permalink to this heading">#</a></h2>
<p>Consider Table <a class="reference internal" href="#cross-section-table"><span class="std std-numref">3.1</span></a> as ordered data that we wish to interpolate.  The energy <span class="math notranslate nohighlight">\(E_i\)</span> is the independent variable <span class="math notranslate nohighlight">\(x_i\)</span> and the cross section is the dependent variable <span class="math notranslate nohighlight">\(g(x_i)\)</span>.  We assume there exists a reasonable approximation representing <span class="math notranslate nohighlight">\(g(x)\)</span> to model between data points using a <span class="math notranslate nohighlight">\((n-1)\)</span>-degree polynomial over an interval <span class="math notranslate nohighlight">\(i\)</span>:</p>
<div class="amsmath math notranslate nohighlight" id="equation-1137d51e-e0ce-4682-8f84-532c749c8eb0">
<span class="eqno">(3.3)<a class="headerlink" href="#equation-1137d51e-e0ce-4682-8f84-532c749c8eb0" title="Permalink to this equation">#</a></span>\[\begin{align}
g_i(x) \simeq a_0 + a_1 x + a_2 x^2 + \cdot + a_{n-1} x^{n-1},\; (x\simeq x_i).
\end{align}\]</div>
<p>Because our fit is local, we do not assume that one <span class="math notranslate nohighlight">\(g(x)\)</span> can fit all the data in the table, where many sets of <span class="math notranslate nohighlight">\(a_i\)</span> exist for each region of the table.  This will include multiple low-degree polynomials that span the entire table.  With some care, the set of polynomials will be well-behaved without introducing unwanted noise or discontinuities.</p>
<p>Lagrange developed a closed-form interpolation formula that directly fits the <span class="math notranslate nohighlight">\((n-1)\)</span>-order polynomial (<span class="math notranslate nohighlight">\(g_i(x)\)</span>) to <span class="math notranslate nohighlight">\(n\)</span> values.  The formula is written as a sum of polynomials:</p>
<div class="amsmath math notranslate nohighlight" id="equation-c4a74c3e-8237-406f-b87b-98cdef3cb31a">
<span class="eqno">(3.4)<a class="headerlink" href="#equation-c4a74c3e-8237-406f-b87b-98cdef3cb31a" title="Permalink to this equation">#</a></span>\[\begin{align}
g(x) \simeq g_1\lambda_1(x) + g_2\lambda_2(x) + \cdots + g_n\lambda_n(x),
\end{align}\]</div>
<p>where</p>
<div class="amsmath math notranslate nohighlight" id="equation-91e8e778-81b2-4a12-8c24-cb02fbc23bb6">
<span class="eqno">(3.5)<a class="headerlink" href="#equation-91e8e778-81b2-4a12-8c24-cb02fbc23bb6" title="Permalink to this equation">#</a></span>\[\begin{align}
\lambda_i(x) = \displaystyle\prod_{j=1; i \ne j}^n \frac{x-x_j}{x_i-x_j} = \frac{x-x_1}{x_i-x_1}\frac{x-x_2}{x_i-x_2}\cdots \frac{x-x_n}{x_i-x_n}.
\end{align}\]</div>
<p>Notice that for <span class="math notranslate nohighlight">\(n\)</span> points, the formula provides a <span class="math notranslate nohighlight">\((n-1)\)</span> degree polynomial.  Let’s work out an example before applying this to our problem.  Suppose you have</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
x &amp;= (0,\ 1,\ 2,\ 4), \\
g &amp;= (-12,\ -12,\ -24,\ -60),
\end{align*}\]</div>
<p>then</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
\lambda_1(x) &amp;= \frac{(x-1)}{(0-1)}\frac{(x-2)}{(0-2)}\frac{(x-4)}{(0-4)} = -\frac{1}{8}(x-1)(x-2)(x-4), \\
\lambda_2(x) &amp;= \frac{(x-0)}{(1-0)}\frac{(x-2)}{(1-2)}\frac{(x-4)}{(1-4)} = \frac{1}{3}x(x-2)(x-4), \\
\lambda_3(x) &amp;= \frac{(x-0)}{(2-0)}\frac{(x-1)}{(2-1)}\frac{(x-4)}{(2-4)} = -\frac{1}{4}x(x-1)(x-4), \\
\lambda_4(x) &amp;= \frac{(x-0)}{(4-0)}\frac{(x-1)}{(4-1)}\frac{(x-2)}{(4-2)} = \frac{1}{24}x(x-1)(x-2),
\end{align*}\]</div>
<p>so that:</p>
<div class="amsmath math notranslate nohighlight" id="equation-05a8ae87-3b0c-4b23-a251-ea10c448ba56">
<span class="eqno">(3.6)<a class="headerlink" href="#equation-05a8ae87-3b0c-4b23-a251-ea10c448ba56" title="Permalink to this equation">#</a></span>\[\begin{align}
g(x) = x^3 - 9x^2 + 8x -12.
\end{align}\]</div>
<p><em>Don’t get tied up in the algebra; this is a computational course.</em></p>
<p>Notice that Lagrange interpolation makes <em>no restriction</em> that the points in the table be evenly spaced. As a check, it is also worth noting that the sum of the Lagrange multipliers equals one,</p>
<div class="math notranslate nohighlight">
\[\sum_i^n \lambda_i = 1.\]</div>
<p>The difference between the value of the polynomial evaluated as some <em>x</em> and that of the actual function is equal to the <em>remainder</em>,</p>
<div class="math notranslate nohighlight">
\[R_n \simeq \frac{(x-x_1)(x-x_2)\cdots(x-x_n)}{n!}g^{(n)(\zeta)},\]</div>
<p>where <span class="math notranslate nohighlight">\(\zeta\)</span> lies somewhere in the interpolation interval but is otherwise undetermined.  This shows that if (significant) high derivatives of <span class="math notranslate nohighlight">\(g(x)\)</span> exist, then the data can’t be well approximated by a polynomial.</p>
<p>It would be useful if we had a function to generate values from the associated polynomial so that we didn’t have to do it by hand.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Lagrange_poly_approx</span><span class="p">(</span><span class="n">x_n</span><span class="p">,</span><span class="n">g_n</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
    <span class="c1">#generate the Lagrange interpolation function</span>
    <span class="c1">#x_n = array of independent values from table</span>
    <span class="c1">#g_n = array of dependent values from table</span>
    <span class="c1">#x = value to evaluate</span>
    <span class="c1">#g = g(x); result of the interpolation</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_n</span><span class="p">)</span> <span class="c1">#determine n</span>
    <span class="n">lam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="p">):</span> 
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span><span class="n">j</span><span class="p">:</span>
                <span class="n">lam</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*=</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x_n</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">x_n</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">x_n</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="c1">#Lagrange multipliers</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lam</span><span class="o">*</span><span class="n">g_n</span><span class="p">)</span>

<span class="c1">#Test g(4) = 60; g(0.5) = -10.125</span>
<span class="n">xvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
<span class="n">gvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span><span class="o">-</span><span class="mi">24</span><span class="p">,</span><span class="o">-</span><span class="mi">60</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;g(4) = &quot;</span><span class="p">,</span><span class="n">Lagrange_poly_approx</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span><span class="n">gvals</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;g(0.5) = &quot;</span><span class="p">,</span><span class="n">Lagrange_poly_approx</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span><span class="n">gvals</span><span class="p">,</span><span class="mf">0.5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>g(4) =  -60.0
g(0.5) =  -10.125
</pre></div>
</div>
</div>
</div>
<p>Let’s go back to Table <a class="reference internal" href="#cross-section-table"><span class="std std-numref">3.1</span></a> and see how the Lagrange interpolation method works for our data using all 9 points.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">225</span><span class="p">,</span><span class="mi">25</span><span class="p">)</span> <span class="c1">#reset xvals to Table 2.1</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">aspect</span><span class="o">*</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="c1">#using the scatter function from matplotlib</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span><span class="n">yvals</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="n">x_interp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
<span class="n">g_interp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_interp</span><span class="p">))</span>
<span class="n">g_linear</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_interp</span><span class="p">))</span>
<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">x_interp</span><span class="p">)):</span>
    <span class="n">g_interp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">Lagrange_poly_approx</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span> <span class="n">yvals</span><span class="p">,</span> <span class="n">x_interp</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="n">g_linear</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">linear_interp</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span> <span class="n">yvals</span><span class="p">,</span> <span class="n">x_interp</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_interp</span><span class="p">,</span><span class="n">g_interp</span><span class="p">,</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_interp</span><span class="p">,</span><span class="n">g_linear</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>


<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">205</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xvals</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$E_i$ (MeV)&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$g(E_i)$ (mb)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">,</span><span class="n">length</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;neutron_scattering_interp.png&quot;</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/985141e74e1721a9a6dff80a10024411e1f480e982965285fc1f6196e17e95b4.png" src="../_images/985141e74e1721a9a6dff80a10024411e1f480e982965285fc1f6196e17e95b4.png" />
</div>
</div>
<p>Notice that the Lagrange interpolation (dashed curve) works best near the middle and away from the end points. The linear interpolation (solid curve) goes through more of the points, but it’s not very smooth.  A Theorist friend has predicted that the resonance energy (peak position) and full width at half max are 75 and 55 MeV, respectively.  <strong>How can we compare values?</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">half_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">g_interp</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
<span class="n">FWHM_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">g_interp</span><span class="o">-</span><span class="n">half_max</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">5</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#search for values that satisfy the conditional |g-FWHM| &lt; 5</span>
<span class="n">FWHM</span> <span class="o">=</span> <span class="n">x_interp</span><span class="p">[</span><span class="n">FWHM_idx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">-</span><span class="n">x_interp</span><span class="p">[</span><span class="n">FWHM_idx</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="c1">#excluded FWHM[0] because it is in the spurious region</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Resonance Energy: &quot;</span><span class="p">,</span><span class="n">x_interp</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">g_interp</span><span class="p">)],</span><span class="s2">&quot; FWHM: &quot;</span><span class="p">,</span><span class="n">FWHM</span><span class="p">)</span> <span class="c1">#argmax returns the index of the max value</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Resonance Energy:  77  FWHM:  60
</pre></div>
</div>
</div>
</div>
<p>Our interpolation produced similar values (77 vs. 75; 60 vs. 55).</p>
</section>
<section id="cubic-splines">
<h2><span class="section-number">3.4. </span>Cubic Splines<a class="headerlink" href="#cubic-splines" title="Permalink to this heading">#</a></h2>
<p>Recall that the Lagrange Interpolation method produces an (<span class="math notranslate nohighlight">\(n-1\)</span>) polynomial fit, where <span class="math notranslate nohighlight">\(n=4\)</span> produces a cubic polynomial.  Using a cubic polynomial, with additional constraints that the first and second derivatives are continuous between intervals, makes the spline fit particularly eye-pleasing.  If the interpolated function is a <em>potential</em>, you can take the derivative to obtain the force.  The process of matching polynomials and their derivatives leads to many simultaneous equations to be solved.  This is tedious work for humans, yet easy for computers and popular for calculations and graphics.</p>
<p>The basic approximation of splines is the representation of the function <span class="math notranslate nohighlight">\(g(x)\)</span> in the subinterval <span class="math notranslate nohighlight">\([x_i,\:x_{i+1}]\)</span> with a cubic polynomial:</p>
<div class="amsmath math notranslate nohighlight" id="equation-81c1cec1-2691-41ff-b6eb-2e46b1c8c89f">
<span class="eqno">(3.7)<a class="headerlink" href="#equation-81c1cec1-2691-41ff-b6eb-2e46b1c8c89f" title="Permalink to this equation">#</a></span>\[\begin{align}
g(x) &amp;\simeq g_i(x),\ \text{for } x_i \leq x \leq x_{i+1}, \\
g_i(x) &amp;= g_i + g_i^\prime(x-x_i) + \frac{1}{2}g_i^{\prime\prime}(x-x_i)^2 + \frac{1}{6}g_i^{\prime\prime\prime}(x-x_i)^3.
\end{align}\]</div>
<p>This shows that the coefficients in the polynomial are the values of <span class="math notranslate nohighlight">\(g(x)\)</span> and its (first, second, and third) derivatives at the tabulated points.  Now we need to determine these derivatives in terms of the <span class="math notranslate nohighlight">\(N\)</span> tabulated <span class="math notranslate nohighlight">\(g_i\)</span> values.  As a result, we obtain the following boundary conditions:</p>
<div class="math notranslate nohighlight">
\[g_i(x_{i+1}) = g_{i+1}(x_{i+1}),\]</div>
<p>The <span class="math notranslate nohighlight">\(i{\rm th}\)</span> spline as the end of its interval is equal to the <span class="math notranslate nohighlight">\((i+1){\rm th}\)</span> spline at the beginning of its interval.  For the derivatives, we have</p>
<div class="amsmath math notranslate nohighlight" id="equation-911f58c6-ae01-4701-b3b9-2d7f31048875">
<span class="eqno">(3.8)<a class="headerlink" href="#equation-911f58c6-ae01-4701-b3b9-2d7f31048875" title="Permalink to this equation">#</a></span>\[\begin{align}
g_{x_i}^\prime(x_i) &amp;= g_i^\prime(x_i),\qquad \text{(first derivatives)} \\
g_{i-1}^{\prime\prime}(x_i) &amp;= g_i^{\prime\prime}(x_i),\qquad \text{(second derivatives)} \\
g_i{\prime\prime\prime} &amp;\simeq \frac{g_{i+1}^{\prime\prime}-g_i^{\prime\prime}}{x_{i+1}-x_i}.\qquad \text{(third derivatives)}
\end{align}\]</div>
<p>If this is unclear, then you are not alone.  It takes some work to go through all the steps.  We are not trying to re-invent the wheel and thus, we will use a library from <code class="docutils literal notranslate"><span class="pre">scipy</span></code> to do the heavy lifting.  If you are still curious, then you can visit this <a class="reference external" href="https://en.wikiversity.org/wiki/Cubic_Spline_Interpolation">guide</a>.  Meanwhile, let’s see how to use the <code class="docutils literal notranslate"><span class="pre">CubicSpine</span></code> library.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">CubicSpline</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">aspect</span><span class="o">*</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="c1">#using the scatter function from matplotlib</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span><span class="n">yvals</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">150</span><span class="p">)</span>

<span class="c1">#x_interp, g_interp, and g_linear are defined in the previous section </span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_interp</span><span class="p">,</span><span class="n">g_interp</span><span class="p">,</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_interp</span><span class="p">,</span><span class="n">g_linear</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1">#Cubic Spline function from scipy</span>
<span class="n">g_spline</span> <span class="o">=</span> <span class="n">CubicSpline</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span><span class="n">yvals</span><span class="p">)</span> <span class="c1">#returns a function</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_interp</span><span class="p">,</span><span class="n">g_spline</span><span class="p">(</span><span class="n">x_interp</span><span class="p">),</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>


<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">205</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xvals</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;$E_i$ (MeV)&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$g(E_i)$ (mb)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">,</span><span class="n">length</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;neutron_scattering_spline.png&quot;</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/525812649f56e708de7f62fc4164ef4037cc597c7a5abe56faa65288fbe2e8e2.png" src="../_images/525812649f56e708de7f62fc4164ef4037cc597c7a5abe56faa65288fbe2e8e2.png" />
</div>
</div>
</section>
<section id="data-fitting">
<h2><span class="section-number">3.5. </span>Data Fitting<a class="headerlink" href="#data-fitting" title="Permalink to this heading">#</a></h2>
<p>A key skill for any scientist is to fit a model to data.  A “good fit” to experimental data can sometimes be difficult.  We will introduce the basics behind data fitting, where the field specific techniques will likely arise later in your career (academia or industry).  There are three main points to keep in mind:</p>
<ol class="arabic simple">
<li><p>Experimental data has errors, then the “best fit” in a statistical sense should <strong>not</strong> pass through all the data points.</p></li>
<li><p>The model (theory) must be appropriate to the data being fit.  Mismatches between the model and data can provide information (i.e., pick a different model).</p></li>
<li><p>Only in the simplest case (linear least-squares fit) can we write down a closed-form solution.  Most realistic problems are solved by <em>trial-and-error</em> search procedures that involve statistical sampling.</p></li>
</ol>
<p>Suppose you have <span class="math notranslate nohighlight">\(N\)</span> data values of the independent variable <span class="math notranslate nohighlight">\(y\)</span> as a function of the dependent variable <span class="math notranslate nohighlight">\(x\)</span> (<span class="math notranslate nohighlight">\(x_i,y_i\pm\sigma_i\)</span>), where the <span class="math notranslate nohighlight">\(\pm \sigma_i\)</span> is the uncertainty in the <em>i</em>th value of <span class="math notranslate nohighlight">\(y\)</span>. Eventually, we will solve the problem where <span class="math notranslate nohighlight">\(y\)</span> represents the number of decays for Ba-137 (using data from Chapter 1) and <span class="math notranslate nohighlight">\(x_i\)</span> are the times.  In general, our goal is to determine how well a <em>model</em> (<span class="math notranslate nohighlight">\(y=g(x)\)</span>) can describe the data.  If we have a good reason that the correct model is identified, then the problem is finding the optimal parameters or constants for the model.</p>
<p>We assume that the model <span class="math notranslate nohighlight">\(g(x)\)</span> contains an additional dependance upon <span class="math notranslate nohighlight">\(M_p\)</span> parameters <span class="math notranslate nohighlight">\(a_m = \left(a_1, a_2, \cdots,a_{M_p}\right)\)</span>.  These parameters are physical parts of the model, such as the size of a box, mass of a particle, or depth of a potential well.  For our problem, we will use the exponential decay function:</p>
<div class="math notranslate nohighlight">
\[ N(t) = N_o e^{-t/\tau}, \]</div>
<p>where the parameters are the lifetime <span class="math notranslate nohighlight">\(\tau\)</span> and the initial decay rate <span class="math notranslate nohighlight">\(dN(0)/dt\)</span>.  In general, we indicate this as <span class="math notranslate nohighlight">\(g(x) = g(x; a_m)\)</span>.  We use the chi-square <span class="math notranslate nohighlight">\(\chi^2\)</span> measure as a gauge of how well a model <span class="math notranslate nohighlight">\(g\)</span> reproduces the data:</p>
<div class="amsmath math notranslate nohighlight" id="equation-923edd79-662c-411d-9210-9da183ddeba0">
<span class="eqno">(3.9)<a class="headerlink" href="#equation-923edd79-662c-411d-9210-9da183ddeba0" title="Permalink to this equation">#</a></span>\[\begin{align}
\chi^2 = \sum_{i=1}^N \frac{(y_i-g(x_i; a_m))^2}{\sigma_i^2}, 
\end{align}\]</div>
<p>where the sum is over the <span class="math notranslate nohighlight">\(N\)</span> data values.  The definition is such that the minimal <span class="math notranslate nohighlight">\(\chi^2\)</span> (smaller values) are better fits.  Notice also that the 1/<span class="math notranslate nohighlight">\(\sigma_i^2\)</span> weights the measurements with larger errors so they contribute less to <span class="math notranslate nohighlight">\(\chi^2\)</span>.  If the errors are not given in the data set, then you can use the standard error estimate <span class="math notranslate nohighlight">\(\sigma_x = \sigma/\sqrt{N}\)</span> where <span class="math notranslate nohighlight">\(\sigma\)</span> is the standard deviation.  If you are interested in other methods of error estimation, look at this introductory <a class="reference external" href="https://towardsdatascience.com/an-introduction-to-the-bootstrap-method-58bcb51b4d60">article</a> from <em>towardsdatascience.com</em>.</p>
<p><strong>Least-squares fitting</strong> refers to adjusting the model parameters until a minimum in <span class="math notranslate nohighlight">\(\chi^2\)</span> is found.  In other words, it is searching for a minimum <em>absolute error</em> <span class="math notranslate nohighlight">\((y_i-g(x_i; a_m))^2\)</span> between the data points <span class="math notranslate nohighlight">\(y_i\)</span> and the model <span class="math notranslate nohighlight">\(g(x_i; a_m)\)</span>.  Recall from <em>Calculus</em> that finding a minimum is taking the derivative and setting it equal to zero.  Therefore, we can express the derivative of <span class="math notranslate nohighlight">\(\chi^2\)</span> with respect to the model parameters <span class="math notranslate nohighlight">\(a_m\)</span> as:</p>
<div class="amsmath math notranslate nohighlight" id="equation-4b909dd2-a853-4c90-b484-4afbc416d21b">
<span class="eqno">(3.10)<a class="headerlink" href="#equation-4b909dd2-a853-4c90-b484-4afbc416d21b" title="Permalink to this equation">#</a></span>\[\begin{align}
\frac{\partial [\chi^2]}{\partial a_m} = \displaystyle\sum_{i=1}^N\frac{[y_i-g(x_i)]}{\sigma_i^2}\frac{\partial g(x_i)}{\partial a_m} = 0,
\end{align}\]</div>
<p>where <span class="math notranslate nohighlight">\(i\)</span> refers to a loop over the data points and <span class="math notranslate nohighlight">\(a_m\)</span> corresponds to the list of model parameters <span class="math notranslate nohighlight">\(\left(a_1,\cdots,a_{M_p}\right)\)</span>.  Typically this results in a sufficiently complicated dependence on the model parameters <span class="math notranslate nohighlight">\(a_m\)</span> to produce a set of <strong>non-linear</strong> equations.  Thus, solutions are found by a <em>trial-and-error</em> search (i.e., test many possible solutions and use <span class="math notranslate nohighlight">\(\chi^2\)</span> to sort them).</p>
<section id="least-squares-fitting-linear-regression">
<h3><span class="section-number">3.5.1. </span>Least-squares Fitting: linear regression<a class="headerlink" href="#least-squares-fitting-linear-regression" title="Permalink to this heading">#</a></h3>
<p>Random errors can produce deviations between the model and the data points, where these errors are described by a Gaussian distribution.  As a heuristic, you know that your fit is good if the <span class="math notranslate nohighlight">\(\chi^2\)</span> is approximately equal to the number of degrees of freedom (<span class="math notranslate nohighlight">\(N-M_p\)</span>).</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\chi^2&lt;&lt; N-M_p\)</span>: it doesn’t mean that you have “great” model or really precise measurement; you probably have too many parameters (over-fitting) or large errors.</p></li>
<li><p><span class="math notranslate nohighlight">\(\chi^2 &gt;&gt; N-M_p\)</span>: the model may not be good, you may have underestimated your errors, or your errors have a bias (i.e., not random).</p></li>
</ul>
<p>Let’s start with a model that <em>linearly</em> depend on the model parameters:</p>
<div class="math notranslate nohighlight">
\[ g(x; [a_1,a_2]) = a_1 + a_2x. \]</div>
<p>This is simply <em>linear regression</em>: there are <span class="math notranslate nohighlight">\(M_p = 2\)</span> parameters with a slope <span class="math notranslate nohighlight">\(a_2\)</span> and y-intercept <span class="math notranslate nohighlight">\(a_1\)</span>.  Even though there are only two parameters to determine, there still may be a large number <span class="math notranslate nohighlight">\(N\)</span> of data points.  A unique solution is not possible unless the number of data point is equal equal to or greater than the number of parameters (<span class="math notranslate nohighlight">\(N&gt;M_p\)</span>).  For this linear case, there are just two derivatives,</p>
<div class="amsmath math notranslate nohighlight" id="equation-a7153e30-f6ca-4e08-a37b-741f6f0cfa8c">
<span class="eqno">(3.11)<a class="headerlink" href="#equation-a7153e30-f6ca-4e08-a37b-741f6f0cfa8c" title="Permalink to this equation">#</a></span>\[\begin{align}
\frac{\partial g(x_i)}{\partial a_1} &amp;= 1, \\
\frac{\partial g(x_i)}{\partial a_2} &amp;= x_i, 
\end{align}\]</div>
<p>and after substitution, the <span class="math notranslate nohighlight">\(\chi^2\)</span> minimization equations can be solved:</p>
<div class="amsmath math notranslate nohighlight" id="equation-91842547-79cd-4202-b026-837008836622">
<span class="eqno">(3.12)<a class="headerlink" href="#equation-91842547-79cd-4202-b026-837008836622" title="Permalink to this equation">#</a></span>\[\begin{align}
\frac{\partial[\chi^2]}{\partial a_1} &amp;= \sum_{i=1}^N \frac{[y_i-a_1-a_2x_i]}{\sigma_i^2} = 0, \\ 
\frac{\partial[\chi^2]}{\partial a_2} &amp;= \displaystyle\sum_{i=1}^N \frac{[y_i-a_1-a_2x_i]}{\sigma_i^2}x_i = 0.
\end{align}\]</div>
<p>Let’s solve these equations for <span class="math notranslate nohighlight">\(a_1\)</span> and <span class="math notranslate nohighlight">\(a_2\)</span> using the average values (<span class="math notranslate nohighlight">\(\bar{x}\)</span>, <span class="math notranslate nohighlight">\(\bar{y}\)</span>):</p>
<div class="amsmath math notranslate nohighlight" id="equation-2cddb6ba-b4c3-4b65-bcb8-f08c18c8e11c">
<span class="eqno">(3.13)<a class="headerlink" href="#equation-2cddb6ba-b4c3-4b65-bcb8-f08c18c8e11c" title="Permalink to this equation">#</a></span>\[\begin{align}
\bar{y}-a_1-a_2\bar{x} &amp;= 0, \\
a_1 &amp;= \bar{y} - a_2\bar{x}, \\  
a_2 &amp;= \frac{\sum_i^N (x_i-\bar{x})(y_i-\bar{y})}{\sum_i^N (x_i-\bar{x})^2}.\quad \text{(best fit slope)}
\end{align}\]</div>
<p>See this <a class="reference external" href="https://towardsdatascience.com/linear-regression-using-least-squares-a4c3456e8570">guide</a> for another approach.</p>
</section>
<section id="least-squares-fitting-implementation">
<h3><span class="section-number">3.5.2. </span>Least-Squares Fitting: Implementation<a class="headerlink" href="#least-squares-fitting-implementation" title="Permalink to this heading">#</a></h3>
<p>Now, the theory behind least squares fitting needs to be interpreted and turned into code.  Part of this exercise will use the <code class="docutils literal notranslate"><span class="pre">curve_fit</span></code> library from <code class="docutils literal notranslate"><span class="pre">scipy</span></code> (<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.curve_fit.html">documentation</a>).  First, let’s import the Ba-137 data and plot it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_x</span><span class="p">,</span><span class="n">data_y</span><span class="p">,</span><span class="n">yerr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="s2">&quot;Ba137_new.txt&quot;</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">comments</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">,</span><span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_y</span><span class="p">)</span>
<span class="c1">#yerr = np.std(data_y)/np.sqrt(N)</span>
<span class="n">generate_data</span> <span class="o">=</span> <span class="s1">&#39;F&#39;</span>
<span class="k">if</span> <span class="n">generate_data</span> <span class="o">==</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span>
    <span class="n">out</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;Ba137_new.txt&quot;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;#Time (s), Counts</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
        <span class="n">Count</span> <span class="o">=</span> <span class="mi">29281</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">data_x</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">/</span><span class="mf">153.6</span><span class="p">)</span>
        <span class="n">rand_count</span> <span class="o">=</span> <span class="n">Count</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%03i</span><span class="s2">, </span><span class="si">%5i</span><span class="s2">, </span><span class="si">%5i</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">data_x</span><span class="p">[</span><span class="n">r</span><span class="p">],</span><span class="n">rand_count</span><span class="p">,</span><span class="n">Count</span><span class="o">-</span><span class="n">rand_count</span><span class="p">))</span>
    <span class="n">out</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">aspect</span><span class="o">*</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span><span class="n">data_y</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">yerr</span><span class="p">),</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>


<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Counts&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">,</span><span class="n">length</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;Ba137.png&quot;</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/feaeb833ef6a53a51f429fc0140887cd74ba6b70647377890ec60a6c2705b62b.png" src="../_images/feaeb833ef6a53a51f429fc0140887cd74ba6b70647377890ec60a6c2705b62b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">N_o</span><span class="p">,</span><span class="n">lam</span><span class="p">):</span>
    <span class="c1">#model for radioactive decay</span>
    <span class="c1">#t = time in sec</span>
    <span class="c1">#N_o = Initial number of parent particles</span>
    <span class="c1">#lam = half-life of Ba-137</span>
    <span class="k">return</span> <span class="n">N_o</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="n">lam</span><span class="p">)</span>

<span class="n">data_x</span><span class="p">,</span><span class="n">data_y</span><span class="p">,</span><span class="n">yerr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="s2">&quot;Ba137_new.txt&quot;</span><span class="p">,</span><span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">comments</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">,</span><span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_y</span><span class="p">)</span>

<span class="c1">#Using the curve_fit function from scipy.optimize library</span>
<span class="c1">#additional arguments can be found in the scipy.optimize documentation</span>
<span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">func</span><span class="p">,</span><span class="n">data_x</span><span class="p">,</span><span class="n">data_y</span><span class="p">,</span><span class="n">sigma</span><span class="o">=</span><span class="n">yerr</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">aspect</span><span class="o">*</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Least-squares Fit for $^</span><span class="si">{137}</span><span class="s2">$Ba Decay&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span><span class="n">data_y</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">yerr</span><span class="p">),</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span><span class="n">func</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span><span class="mi">29375</span><span class="p">,</span><span class="mf">153.1</span><span class="p">),</span><span class="s1">&#39;b--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.99</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="s2">&quot;$N_o$ = </span><span class="si">%5i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;xx-large&#39;</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.99</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="s2">&quot;$\lambda$ = </span><span class="si">%3.1f</span><span class="s2"> s&quot;</span> <span class="o">%</span> <span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;xx-large&#39;</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Counts&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">,</span><span class="n">length</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;Ba137_wModel.png&quot;</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/fe82cd00b82d61ed28413219db610d5f897921b0d4e06d504e93dede30e594f1.png" src="../_images/fe82cd00b82d61ed28413219db610d5f897921b0d4e06d504e93dede30e594f1.png" />
</div>
</div>
<p>We used the <code class="docutils literal notranslate"><span class="pre">curve_fit</span></code> function from <code class="docutils literal notranslate"><span class="pre">scipy.optimize</span></code> to generate a best bit curve to the data.  The <code class="docutils literal notranslate"><span class="pre">curve_fit</span></code> function returns two objects:</p>
<ol class="arabic simple">
<li><p>an array of best fit parameters and</p></li>
<li><p>a matrix estimating the covariance of the parameters.</p></li>
</ol>
<p><strong>What is the covariance?</strong>  Mathematically, it is the mean (or expectation) of the product of the deviations along 2 or more dimensions.  Check out the <a class="reference external" href="https://en.wikipedia.org/wiki/Covariance">wikipedia</a> article for more details.</p>
<p>Recall that the least-squares method is largely <em>trial-and-error</em> that uses the <span class="math notranslate nohighlight">\(\chi^2\)</span> function to sort out the best fit solutions.  Therefore, there are many solutions that <strong>fit</strong> and the best-fit parameters can be tuned against those solutions (i.e., the <span class="math notranslate nohighlight">\(N_o\)</span> can be tweaked and this changes the <span class="math notranslate nohighlight">\(\lambda\)</span>).  Suppose we have two parameters (X,Y), here is an example of some of the possibilities for the covariance:</p>
<figure class="align-default" id="covariance-fig">
<a class="reference internal image-reference" href="../_images/covariance.png"><img alt="covariance" src="../_images/covariance.png" style="width: 600px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 3.1 </span><span class="caption-text">Illustration of the sign of the covariance of two random variables. Image Credit: <a class="reference external" href="https://en.wikipedia.org/wiki/Covariance">Wikipedia:covariance</a>.</span><a class="headerlink" href="#covariance-fig" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>The leftmost plot shows a negative slope (or correlation) in the covariance, where the rightmost plot illustrates a positive slope.  The middle plot shows that the two parameters are uncorrelated (i.e., independent).  The <code class="docutils literal notranslate"><span class="pre">curve_fit</span></code> function returns a 2x2 matrix for the covariance of our decay model with a row and column for <span class="math notranslate nohighlight">\(N_o\)</span> and <span class="math notranslate nohighlight">\(\lambda\)</span>, respectively.  The covariance of a parameter with itself is simply the estimated error in that parameter (e.g., Cov(X,X)=Var(X)=<span class="math notranslate nohighlight">\(\sigma^2_X\)</span>).  In this approach the error is assumed to be Gaussian, meaning that it symmetric in the <span class="math notranslate nohighlight">\(\pm \sigma_x\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#The pcov matrix</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pcov</span><span class="p">)</span>
<span class="c1">#Notice that the off diagonal terms are identical and negative</span>

<span class="c1">#Using the pcov matrix to calculate the best-fit parameters with errors</span>
<span class="n">sigma_N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pcov</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">sigma_lam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">pcov</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sigma_N = &quot;</span><span class="p">,</span><span class="n">sigma_N</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sigma_lam = &quot;</span><span class="p">,</span><span class="n">sigma_lam</span><span class="p">)</span>
<span class="c1">#The reported error does **not** take significant figures into account (we must do that ourselves)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;N_o = </span><span class="si">%5d</span><span class="s2"> +/- </span><span class="si">%3d</span><span class="s2"> particles&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">sigma_N</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lambda = </span><span class="si">%3.1f</span><span class="s2"> +/- </span><span class="si">%3.1f</span><span class="s2"> sec&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">sigma_lam</span><span class="p">))</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">aspect</span><span class="o">*</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Least-squares Fit for $^</span><span class="si">{137}</span><span class="s2">$Ba Decay&quot;</span><span class="p">)</span>


<span class="c1">#plot 3-sigma (99.8%) sample of solutions</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000</span><span class="p">):</span>
    <span class="n">samp_N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">3</span><span class="o">*</span><span class="n">sigma_N</span><span class="p">)</span>
    <span class="n">samp_lam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">3</span><span class="o">*</span><span class="n">sigma_lam</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span><span class="n">func</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span><span class="n">samp_N</span><span class="p">,</span><span class="n">samp_lam</span><span class="p">),</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="c1">#plot best-fit and data</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span><span class="n">func</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span><span class="o">*</span><span class="n">popt</span><span class="p">),</span><span class="s1">&#39;b--&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span><span class="n">data_y</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">yerr</span><span class="p">),</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.99</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="s2">&quot;$N_o$ = </span><span class="si">%5d</span><span class="s2"> +/- </span><span class="si">%3d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">sigma_N</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;xx-large&#39;</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.99</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="s2">&quot;$\lambda$ = </span><span class="si">%3.1f</span><span class="s2"> +/- </span><span class="si">%3.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">popt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">sigma_lam</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="s1">&#39;xx-large&#39;</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span><span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">500</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Counts&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">,</span><span class="n">length</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">8.0</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;Ba137_wModel_err.png&quot;</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[[ 4.44173831e+03 -1.95903577e+01]
 [-1.95903577e+01  9.13808141e-02]]
sigma_N =  66.64636753495589
sigma_lam =  0.30229259690448534
N_o = 29258 +/-  66 particles
lambda = 153.6 +/- 0.3 sec
</pre></div>
</div>
<img alt="../_images/b9e4d360d11269151964b421256afa7cfff02583a08e21fc964d6a92f0eff283.png" src="../_images/b9e4d360d11269151964b421256afa7cfff02583a08e21fc964d6a92f0eff283.png" />
</div>
</div>
</section>
<section id="maximum-likelihood-estimation">
<h3><span class="section-number">3.5.3. </span>Maximum Likelihood Estimation<a class="headerlink" href="#maximum-likelihood-estimation" title="Permalink to this heading">#</a></h3>
<p>Another method of data fitting is to use maximum likelihood estimation (MLE).  This process is heavier on statistics, where I will show the basics.  The advantage of MLE is that you can better estimate the errors in the model parameters, especially when they are non-symmetric.  The good news is there is a python package called <code class="docutils literal notranslate"><span class="pre">emcee</span></code> or the <em>emcee hammer</em> (see the <a class="reference external" href="https://emcee.readthedocs.io/en/stable/">documentation</a>).  This package allows you to employ different sampling methods and has quickly become a common tool in research (in astronomy).</p>
<p><strong>To import emcee: it needs to be installed into your python environment through ‘pip install emcee’ or ‘conda install -c conda-forge emcee’ in the terminal.</strong>  To install python packages in Google Colab, simply add <code class="docutils literal notranslate"><span class="pre">!</span></code> to the front to get <code class="docutils literal notranslate"><span class="pre">!pip</span> <span class="pre">install</span> <span class="pre">emcee</span></code>.</p>
<p>The Least-Squares method tries to solve the data fitting problem directly, where MLE takes a different approach.  MLE is concerned with the inverse problem: given the observed data <span class="math notranslate nohighlight">\(x = [x_i]_{i=1}^N\)</span> and a model, find the parameters that yield a probability distribution function (pdf) that is <em>most likely</em> to represent the data.  The Likelihood function <span class="math notranslate nohighlight">\(\mathcal{L}\)</span> is used to determine whether the trial parameters are likely to represent the data.  To sample the probability space more efficiently, the log-likelihood is used and we can construct a Gaussian that is analogous to <span class="math notranslate nohighlight">\(\chi^2\)</span> by:</p>
<div class="math notranslate nohighlight">
\[ \log \mathcal{L} = -\frac{1}{2}\displaystyle\sum_{i=1}^N \left[\frac{(y_i-g(x_i,a_m))^2}{\sigma_i^2} + \log(2\pi\sigma_i^2)\right], \]</div>
<p>where <span class="math notranslate nohighlight">\(log\)</span> refers to the natural logarithm.</p>
<p>You will notice that this looks much like the <span class="math notranslate nohighlight">\(\chi^2\)</span>, but it contains an extra 1/2 factor and an additional term.  The second term comes from the normalization factor for a Gaussian pdf.</p>
<p>Besides the Likelihood function, there is the <em>prior</em> probability.  Priors are used when you have some prior knowledge about the data you are trying to model.  For example, using our data for Ba-137 we can reasonably suggest that the following condition: <span class="math notranslate nohighlight">\(25000 \leq N_o \leq 50000\)</span>.  We don’t know which value within the interval (25,000–50,000) is more probable and therefore we call this a <strong>uniform</strong> prior, where values outside the conditions are given a penalty.  We can do the same kind of estimation for <span class="math notranslate nohighlight">\(\lambda\)</span> to get: <span class="math notranslate nohighlight">\(75 \leq \lambda \leq 300\)</span>, since <span class="math notranslate nohighlight">\(\lambda\)</span> is related to the half-life.  Now that we know about the Likelihood function and priors, let’s get coding.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">emcee</span>

<span class="k">def</span> <span class="nf">log_prob</span><span class="p">(</span><span class="n">a_m</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">yerr</span><span class="p">):</span>
    <span class="c1">#Log Likelihood function given a set of model parameters a_m</span>
    <span class="c1">#x,y,yerr are arrays passed in as arguments (they are the same every time, only a_m changes)</span>
    <span class="n">N_o</span><span class="p">,</span> <span class="n">lam</span> <span class="o">=</span> <span class="n">a_m</span> <span class="c1">#unpack the model parameters</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">N_o</span><span class="p">,</span><span class="n">lam</span><span class="p">)</span> <span class="c1">#evaluate the model using the guess for N_o, lam</span>
    <span class="k">return</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y</span><span class="o">-</span><span class="n">model</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">yerr</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">yerr</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="c1">#Gaussian likelihood function</span>

<span class="k">def</span> <span class="nf">log_prior</span><span class="p">(</span><span class="n">a_m</span><span class="p">):</span>
    <span class="c1">#Log Prior probability function (usually uniform) of the model parameters: a_m</span>
    <span class="n">N_o</span><span class="p">,</span> <span class="n">lam</span> <span class="o">=</span> <span class="n">a_m</span> <span class="c1">#upack the model parameters</span>
    <span class="c1">#uniform priors; penalty if not in the interval</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="mi">25000</span> <span class="o">&lt;=</span> <span class="n">N_o</span> <span class="o">&lt;=</span> <span class="mi">50000</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="mi">75</span> <span class="o">&lt;=</span> <span class="n">lam</span> <span class="o">&lt;=</span> <span class="mi">300</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">return</span> <span class="mf">0.</span>

<span class="k">def</span> <span class="nf">lnprob</span><span class="p">(</span><span class="n">a_m</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">yerr</span><span class="p">):</span>
    <span class="c1">#Full probability function that combines the prior with the log likelihood</span>
    <span class="c1">#a_m = model parameters</span>
    <span class="c1">#x,y,yerr = time data, counts, and experimental errors on counts</span>
    <span class="n">lp</span> <span class="o">=</span> <span class="n">log_prior</span><span class="p">(</span><span class="n">a_m</span><span class="p">)</span> <span class="c1">#get the log prior probability</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">lp</span><span class="p">):</span> <span class="c1">#check if the log_prior returned inf</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="c1">#stop checking; guess different model parameters</span>
    <span class="k">return</span> <span class="n">lp</span> <span class="o">+</span> <span class="n">log_prob</span><span class="p">(</span><span class="n">a_m</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">yerr</span><span class="p">)</span> <span class="c1">#return the probability to the sampler</span>


<span class="c1">#emcee utilizes walkers which is like taking a bag full of guesses and evaluating them all at once</span>
<span class="n">nwalkers</span> <span class="o">=</span> <span class="mi">32</span> <span class="c1">#you shouldn&#39;t increase this unless using a cluster</span>
<span class="n">ndim</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1">#number of model parameters</span>

<span class="n">init_state</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nwalkers</span><span class="p">):</span>
    <span class="c1">#initial guess for the model parameters distributed among the walkers</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">27000</span><span class="p">,</span><span class="mi">100</span><span class="p">])</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">init_state</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

<span class="c1">#invoke the default sampler;  more details in the documentation</span>
<span class="n">sampler</span> <span class="o">=</span> <span class="n">emcee</span><span class="o">.</span><span class="n">EnsembleSampler</span><span class="p">(</span><span class="n">nwalkers</span><span class="p">,</span> <span class="n">ndim</span><span class="p">,</span> <span class="n">lnprob</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">data_x</span><span class="p">,</span> <span class="n">data_y</span><span class="p">,</span> <span class="n">yerr</span><span class="p">))</span>
<span class="n">sampler</span><span class="o">.</span><span class="n">run_mcmc</span><span class="p">(</span><span class="n">init_state</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">skip_initial_state_check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">#run the sampler</span>

<span class="c1">#discard the first 100 samples as burn-in and only take every 15th iteration</span>
<span class="n">flat_samples</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">get_chain</span><span class="p">(</span><span class="n">discard</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">thin</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|                                                                                                                                  | 0/5000 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/saturnaxis/anaconda3/lib/python3.9/site-packages/emcee/moves/red_blue.py:99: RuntimeWarning: invalid value encountered in double_scalars
  lnpdiff = f + nlp - state.log_prob[j]

  2%|██▌                                                                                                                   | 107/5000 [00:00&lt;00:04, 1068.71it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  4%|█████                                                                                                                 | 214/5000 [00:00&lt;00:04, 1049.48it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  6%|███████▌                                                                                                              | 319/5000 [00:00&lt;00:04, 1044.92it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  8%|██████████                                                                                                            | 424/5000 [00:00&lt;00:04, 1035.21it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 11%|████████████▍                                                                                                         | 528/5000 [00:00&lt;00:04, 1033.49it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 13%|██████████████▉                                                                                                       | 632/5000 [00:00&lt;00:04, 1014.46it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 15%|█████████████████▎                                                                                                    | 734/5000 [00:00&lt;00:04, 1005.31it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 17%|███████████████████▋                                                                                                  | 835/5000 [00:00&lt;00:04, 1001.64it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 19%|██████████████████████                                                                                                | 936/5000 [00:00&lt;00:04, 1000.85it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 21%|████████████████████████▍                                                                                             | 1037/5000 [00:01&lt;00:04, 982.37it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 23%|██████████████████████████▋                                                                                          | 1143/5000 [00:01&lt;00:03, 1005.11it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 25%|█████████████████████████████▏                                                                                       | 1249/5000 [00:01&lt;00:03, 1020.60it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 27%|███████████████████████████████▋                                                                                     | 1355/5000 [00:01&lt;00:03, 1031.12it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 29%|██████████████████████████████████▎                                                                                  | 1464/5000 [00:01&lt;00:03, 1047.06it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 31%|████████████████████████████████████▋                                                                                | 1569/5000 [00:01&lt;00:03, 1033.70it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 33%|███████████████████████████████████████▏                                                                             | 1673/5000 [00:01&lt;00:03, 1034.71it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 36%|█████████████████████████████████████████▋                                                                           | 1779/5000 [00:01&lt;00:03, 1040.18it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 38%|████████████████████████████████████████████                                                                         | 1885/5000 [00:01&lt;00:02, 1044.69it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 40%|██████████████████████████████████████████████▌                                                                      | 1991/5000 [00:01&lt;00:02, 1047.79it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 42%|█████████████████████████████████████████████████                                                                    | 2096/5000 [00:02&lt;00:02, 1045.76it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 44%|███████████████████████████████████████████████████▌                                                                 | 2201/5000 [00:02&lt;00:02, 1044.34it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 46%|█████████████████████████████████████████████████████▉                                                               | 2306/5000 [00:02&lt;00:02, 1043.70it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 48%|████████████████████████████████████████████████████████▍                                                            | 2411/5000 [00:02&lt;00:02, 1043.12it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 50%|██████████████████████████████████████████████████████████▊                                                          | 2516/5000 [00:02&lt;00:02, 1016.76it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 52%|█████████████████████████████████████████████████████████████▎                                                       | 2621/5000 [00:02&lt;00:02, 1025.09it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 55%|███████████████████████████████████████████████████████████████▉                                                     | 2730/5000 [00:02&lt;00:02, 1041.66it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 57%|██████████████████████████████████████████████████████████████████▍                                                  | 2837/5000 [00:02&lt;00:02, 1048.85it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 59%|████████████████████████████████████████████████████████████████████▊                                                | 2943/5000 [00:02&lt;00:01, 1049.95it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 61%|███████████████████████████████████████████████████████████████████████▎                                             | 3049/5000 [00:02&lt;00:01, 1042.50it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 63%|█████████████████████████████████████████████████████████████████████████▊                                           | 3157/5000 [00:03&lt;00:01, 1053.50it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 65%|████████████████████████████████████████████████████████████████████████████▎                                        | 3263/5000 [00:03&lt;00:01, 1046.66it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 67%|██████████████████████████████████████████████████████████████████████████████▉                                      | 3372/5000 [00:03&lt;00:01, 1056.81it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 70%|█████████████████████████████████████████████████████████████████████████████████▍                                   | 3478/5000 [00:03&lt;00:01, 1053.52it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 72%|███████████████████████████████████████████████████████████████████████████████████▉                                 | 3585/5000 [00:03&lt;00:01, 1057.68it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 74%|██████████████████████████████████████████████████████████████████████████████████████▎                              | 3691/5000 [00:03&lt;00:01, 1057.59it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 76%|████████████████████████████████████████████████████████████████████████████████████████▉                            | 3799/5000 [00:03&lt;00:01, 1063.57it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 78%|███████████████████████████████████████████████████████████████████████████████████████████▍                         | 3906/5000 [00:03&lt;00:01, 1064.07it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 80%|█████████████████████████████████████████████████████████████████████████████████████████████▉                       | 4013/5000 [00:03&lt;00:00, 1053.68it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 82%|████████████████████████████████████████████████████████████████████████████████████████████████▍                    | 4119/5000 [00:03&lt;00:00, 1048.48it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 84%|██████████████████████████████████████████████████████████████████████████████████████████████████▊                  | 4224/5000 [00:04&lt;00:00, 1046.80it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 87%|█████████████████████████████████████████████████████████████████████████████████████████████████████▎               | 4331/5000 [00:04&lt;00:00, 1050.93it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 89%|███████████████████████████████████████████████████████████████████████████████████████████████████████▊             | 4438/5000 [00:04&lt;00:00, 1056.01it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 91%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▎          | 4544/5000 [00:04&lt;00:00, 1045.23it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 93%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▊        | 4651/5000 [00:04&lt;00:00, 1050.08it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 95%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████▍     | 4761/5000 [00:04&lt;00:00, 1063.20it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 97%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉   | 4868/5000 [00:04&lt;00:00, 1057.36it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍| 4975/5000 [00:04&lt;00:00, 1061.09it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 5000/5000 [00:04&lt;00:00, 1041.46it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">corner</span>

<span class="c1">#show the correlation between parameters</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;$N_o$&quot;</span><span class="p">,</span><span class="s2">&quot;$\lambda$&quot;</span><span class="p">]</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">corner</span><span class="o">.</span><span class="n">corner</span><span class="p">(</span><span class="n">flat_samples</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">truths</span><span class="o">=</span><span class="n">popt</span><span class="p">,</span><span class="n">quantiles</span><span class="o">=</span><span class="p">[</span><span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.84</span><span class="p">],</span><span class="n">show_titles</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">title_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fontsize&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">},</span><span class="n">labelpad</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/1a78bd316bd0e9dc3ad94f8f6e4e0a447ea2bdde41338294a4400d7c3b1a44c1.png" src="../_images/1a78bd316bd0e9dc3ad94f8f6e4e0a447ea2bdde41338294a4400d7c3b1a44c1.png" />
</div>
</div>
<p>In the above figure (created with <a class="reference external" href="https://corner.readthedocs.io/en/latest/index.html">corner</a>), we recover a result that is consistent with the Least-Squares approach (i.e., overlapping within the 1-sigma errors).  <strong>Note that this result is the raw output and you need to report values with the correct number of significant digits.</strong></p>
</section>
</section>
<section id="problems">
<h2><span class="section-number">3.6. </span>Problems<a class="headerlink" href="#problems" title="Permalink to this heading">#</a></h2>
<p>Complete the following problems in a Jupyter notebook, where you will save your results as an external file (*.png).</p>
<p>Create a <span class="math notranslate nohighlight">\(\LaTeX\)</span> document with:</p>
<ul class="simple">
<li><p>an abstract summary</p></li>
<li><p>sections for each problem that <strong>state</strong> the problem, <strong>explain</strong> your approach to solving the problem, and <strong>display</strong> the results</p></li>
<li><p>include a reference for each solution (this can be textbooks)</p></li>
</ul>
<div class="admonition-problem-1 admonition">
<p class="admonition-title">Problem 1</p>
<p><strong>Consider the set of data points</strong> (x, y): {(.69, 4.60), (.12, 3.71), (.21, 3.95), (.63, 4.33), (.66, 4.82), (.53, 4.13), (.84, 5.26)}.</p>
<p><strong>(a)</strong> Find the line of least squares fit for this data.<br />
<strong>(b)</strong> Add 1 to the x-coordinate of each of the points and find the line of least squares fit for this modified data.<br />
<strong>(c)</strong> Add 1 to the y-coordinate of each of the original points and find the line of least squares fit for this modified data.</p>
</div>
<div class="admonition-problem-2 admonition">
<p class="admonition-title">Problem 2</p>
<p><strong>Consider the following data points:</strong></p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>t</p></th>
<th class="head"><p>y</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0.25</p></td>
<td><p>1.58</p></td>
</tr>
<tr class="row-odd"><td><p>1.88</p></td>
<td><p>6.35</p></td>
</tr>
<tr class="row-even"><td><p>0.56</p></td>
<td><p>1.77</p></td>
</tr>
<tr class="row-odd"><td><p>0.82</p></td>
<td><p>2.18</p></td>
</tr>
<tr class="row-even"><td><p>1.92</p></td>
<td><p>6.63</p></td>
</tr>
<tr class="row-odd"><td><p>0.99</p></td>
<td><p>2.11</p></td>
</tr>
<tr class="row-even"><td><p>1.15</p></td>
<td><p>3.61</p></td>
</tr>
<tr class="row-odd"><td><p>2.09</p></td>
<td><p>8.91</p></td>
</tr>
<tr class="row-even"><td><p>1.47</p></td>
<td><p>5.07</p></td>
</tr>
</tbody>
</table>
<p><strong>Find a curve of the form: <span class="math notranslate nohighlight">\(y = a e^{b t}\)</span> that best fits this data.</strong></p>
</div>
<div class="admonition-problem-3 admonition">
<p class="admonition-title">Problem 3</p>
<p><strong>Consider the data points from Problem 2 corresponds to the measurement of two quantities that are known to satisfy a power relationship, <span class="math notranslate nohighlight">\(y = a x^k\)</span>.</strong>  Use the method of least squares to find the appropriate values for the constants <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(k\)</span>.  Graph the resulting curve along with the original data.</p>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "saturnaxis/CompPhysics",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Chapter_3"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="../Chapter_2/Python_Basics.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">2. </span>Python Basics</p>
      </div>
    </a>
    <a class="right-next"
       href="../Chapter_4/Integration.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">4. </span>Integration</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fitting-an-experimental-spectrum-problem">3.1. Fitting an experimental spectrum (Problem)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-interpolation">3.2. Linear Interpolation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lagrange-interpolation">3.3. Lagrange Interpolation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cubic-splines">3.4. Cubic Splines</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-fitting">3.5. Data Fitting</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#least-squares-fitting-linear-regression">3.5.1. Least-squares Fitting: linear regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#least-squares-fitting-implementation">3.5.2. Least-Squares Fitting: Implementation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#maximum-likelihood-estimation">3.5.3. Maximum Likelihood Estimation</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#problems">3.6. Problems</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Billy Quarles
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>